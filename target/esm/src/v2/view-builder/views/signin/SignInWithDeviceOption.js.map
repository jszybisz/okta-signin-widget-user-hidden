{"version":3,"file":"SignInWithDeviceOption.js","sources":["../../../../../../../src/v2/view-builder/views/signin/SignInWithDeviceOption.js"],"sourcesContent":["import { View, createButton, loc } from '@okta/courage';\nimport hbs from '@okta/handlebars-inline-precompile';\nimport Util from '../../../../util/Util';\nimport Enums from '../../../../util/Enums';\nimport { UNIVERSAL_LINK_POST_DELAY } from '../../utils/Constants';\nimport { FORMS } from '../../../ion/RemediationConstants';\nimport { appendLoginHint } from '../../utils/ChallengeViewUtil';\n\nexport default View.extend({\n  className: 'sign-in-with-device-option',\n  template: hbs`\n    <div class=\"okta-verify-container\">\n    {{#if signInWithDeviceIsRequired}}\n      <div class=\"signin-with-ov-description\">\n      </div>\n    {{/if}}\n    </div>\n    {{#unless signInWithDeviceIsRequired}}\n    <div class=\"separation-line\">\n      <span>{{i18n code=\"authbutton.divider.text\" bundle=\"login\"}}</span>\n    </div>\n    {{/unless}}\n  `,\n  initialize() {\n    const appState = this.options.appState;\n    const deviceChallengePollRemediation = appState.hasRemediationObject(FORMS.LAUNCH_AUTHENTICATOR);\n    \n    const deviceChallenge = deviceChallengePollRemediation?.relatesTo?.value;\n    this.add(createButton({\n      className: 'button',\n      icon: 'okta-verify-authenticator',\n      title: loc('oktaVerify.button', 'login'),\n      click() {\n        if (this.model.get('identifier')) {\n          this.options.settings.set('identifier', encodeURIComponent(this.model.get('identifier')));\n        }\n\n        const isUVapproach = deviceChallenge?.challengeMethod === Enums.UNIVERSAL_LINK_CHALLENGE;\n        if (isUVapproach) {\n          // launch the Okta Verify app\n          let deviceChallengeUrl = appendLoginHint(deviceChallenge.href, this.options?.settings?.get('identifier'));\n          Util.redirect(deviceChallengeUrl);\n        }\n\n        const isAppLinkapproach = deviceChallenge?.challengeMethod === Enums.APP_LINK_CHALLENGE;\n        if (isAppLinkapproach) {\n          // launch the Okta Verify app\n          let deviceChallengeUrl = appendLoginHint(deviceChallenge.href, this.options?.settings?.get('identifier'));\n          Util.redirect(deviceChallengeUrl, window, true);\n        }\n\n        // OKTA-350084\n        // For the universal link (iOS) and app link (Android) approach,\n        // we need to 1. launch the Okta Verify app\n        // and 2. take the enduser to the next step right away\n        // In Safari, when Okta Verify app is not installed, step 1 responds with error immediately,\n        // then step 2 will respond with error.\n        // To avoid showing the error right before switching to the next UI,\n        // wait for 500 milliseconds before invoking step 2\n        Util.callAfterTimeout(() => {\n          if (this.options.isRequired) {\n            appState.trigger('saveForm', this.model);\n          } else {\n            appState.trigger('invokeAction', FORMS.LAUNCH_AUTHENTICATOR, {'rememberMe': this.model.get('rememberMe')});\n          }\n        }, isUVapproach || isAppLinkapproach ? UNIVERSAL_LINK_POST_DELAY : 0);\n      }\n    }), '.okta-verify-container');\n  },\n\n  getTemplateData() {\n    return {\n      signInWithDeviceIsRequired: !!this.options.isRequired,\n    };\n  },\n\n  postRender() {\n    if(this.options.isRequired) {\n      const appLabel = this.options.appState.attributes?.app?.label;\n      const resourceLabel = appLabel ? loc('oktaVerify.appDescription', 'login', [appLabel]) : \n        loc('oktaVerify.description', 'login');\n      const ovDescContainer = this.$el.find('.signin-with-ov-description');\n      ovDescContainer.text(resourceLabel);\n    }\n  }\n});\n"],"names":["View","extend","className","template","_Handlebars2","1","container","depth0","helpers","partials","data","3","lookupProperty","parent","propertyName","Object","prototype","hasOwnProperty","call","undefined","escapeExpression","hooks","helperMissing","nullContext","main","stack1","alias1","program","noop","initialize","_deviceChallengePollR","appState","options","deviceChallengePollRemediation","hasRemediationObject","FORMS","LAUNCH_AUTHENTICATOR","deviceChallenge","relatesTo","value","add","createButton","icon","title","loc","click","model","get","settings","set","encodeURIComponent","isUVapproach","challengeMethod","Enums","UNIVERSAL_LINK_CHALLENGE","_this$options","_this$options$setting","deviceChallengeUrl","appendLoginHint","href","Util","redirect","isAppLinkapproach","APP_LINK_CHALLENGE","_this$options2","_this$options2$settin","window","callAfterTimeout","isRequired","trigger","UNIVERSAL_LINK_POST_DELAY","getTemplateData","signInWithDeviceIsRequired","postRender","_this$options$appStat","_this$options$appStat2","appLabel","attributes","app","label","resourceLabel","ovDescContainer","$el","find","text"],"mappings":"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"}