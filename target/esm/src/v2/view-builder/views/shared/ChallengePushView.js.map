{"version":3,"file":"ChallengePushView.js","sources":["../../../../../../../src/v2/view-builder/views/shared/ChallengePushView.js"],"sourcesContent":["// Common view for OV push and custom push.\nimport { loc, createButton, View } from '@okta/courage';\nimport hbs from '@okta/handlebars-inline-precompile';\nimport { BaseFormWithPolling } from '../../internals';\nimport polling from '../shared/polling';\nimport { WARNING_TIMEOUT } from '../../utils/Constants';\nimport BaseAuthenticatorView from '../../components/BaseAuthenticatorView';\nimport { AUTHENTICATOR_KEY } from '../../../ion/RemediationConstants';\n\nconst warningTemplate = View.extend({\n  className: 'okta-form-infobox-warning infobox infobox-warning',\n  template: hbs`\n    <span class=\"icon warning-16\"></span>\n    <p>{{warning}}</p>\n  `\n});\nconst Body = BaseFormWithPolling.extend(Object.assign(\n  {\n    noButtonBar: true,\n\n    title() {\n      return this.isOV() ? loc('oie.okta_verify.push.title', 'login') :\n        loc('oie.verify.custom_app.title', 'login', [this.options.appState.getAuthenticatorDisplayName()]);\n    },\n\n    initialize() {\n      BaseFormWithPolling.prototype.initialize.apply(this, arguments);\n      // 'hasSavingState' would be true by default.\n      // Setting it to false when auth key is okta_verify or custom_app with autochallenge schema\n      // So that 'o-form-saving' css class is not added while polling and checkbox remains enabled.\n      if ((this.isOV() || this.isCustomApp()) && this.isAutoChallengeSupported()) {\n        this.hasSavingState = false;\n      }\n      this.listenTo(this.model, 'error', this.stopPoll);\n      this.addView();\n    },\n\n    addView() {\n      this.add(createButton({\n        className: 'button button-wide button-primary send-push link-button-disabled',\n        title: this.isOV() ? loc('oie.okta_verify.push.sent', 'login') : loc('oie.custom_app.push.sent', 'login'),\n        click: (e) => {\n          e.preventDefault();\n        }\n      }));\n      this.add(\n        `<span class='accessibility-text' role='alert'>\n        ${this.isOV() ? loc('oie.okta_verify.push.sent', 'login') : loc('oie.custom_app.push.sent', 'login')}</span>`,\n      );\n    },\n\n    render() {\n      BaseFormWithPolling.prototype.render.apply(this, arguments);\n\n      const checkbox = this.$el.find('[data-se=\"o-form-fieldset-autoChallenge\"]');\n\n      if (!this.isAutoChallengeSupported()) {\n        checkbox.length && checkbox.hide();\n      } else if (this.isOV() || this.isCustomApp()) {\n        // Move checkbox below the button\n        // Checkbox is rendered by BaseForm using remediation response and\n        // hence by default always gets added above buttons.\n        checkbox.length && this.$el.find('.o-form-fieldset-container').append(checkbox);\n      }\n    },\n\n    postRender() {\n      BaseFormWithPolling.prototype.postRender.apply(this, arguments);\n\n      const className = this.isOV() ?\n        'okta-verify-push-challenge' : ' custom-app-push-challenge';\n      this.$el.addClass(className);\n      this.startPoll();\n    },\n\n    startPoll() {\n      this.startPolling();\n      this.warningTimeout = setTimeout(() => {\n        const warningText = this.isOV() ? loc('oktaverify.warning', 'login') :\n          loc('oie.custom_app.push.warning', 'login', [this.options.appState.getAuthenticatorDisplayName()]);\n        this.showWarning(warningText);\n      }, WARNING_TIMEOUT);\n    },\n\n    stopPoll() {\n      this.stopPolling();\n      this.clearWarning();\n    },\n\n    showWarning(msg) {\n      this.clearWarning();\n      this.add(warningTemplate, '.o-form-error-container', {options: {warning: msg}});\n    },\n\n    clearWarning() {\n      if (this.$('.o-form-error-container div').hasClass('okta-form-infobox-warning')) {\n        this.$('.okta-form-infobox-warning').remove();\n      }\n      clearTimeout(this.warningTimeout);\n    },\n\n    remove() {\n      BaseFormWithPolling.prototype.remove.apply(this, arguments);\n      this.stopPoll();\n    },\n\n    isOV() {\n      return this.options.appState.get('authenticatorKey') === AUTHENTICATOR_KEY.OV;\n    },\n\n    isCustomApp() {\n      return this.options.appState.get('authenticatorKey') === AUTHENTICATOR_KEY.CUSTOM_APP;\n    },\n\n    isAutoChallengeSupported() {\n      return (this.options.appState.getSchemaByName('autoChallenge') !== null &&\n        this.options.appState.getSchemaByName('autoChallenge') !== undefined);\n    }\n  },\n\n  polling,\n));\n\nconst AuthenticatorView = BaseAuthenticatorView.extend({\n  Body,\n});\n\nexport {\n  AuthenticatorView as default,\n  Body,\n};\n"],"names":["warningTemplate","View","extend","className","template","_Handlebars2","main","container","depth0","helpers","partials","data","helper","lookupProperty","parent","propertyName","Object","prototype","hasOwnProperty","call","undefined","escapeExpression","hooks","helperMissing","nullContext","Body","BaseFormWithPolling","assign","noButtonBar","title","isOV","loc","options","appState","getAuthenticatorDisplayName","initialize","apply","arguments","isCustomApp","isAutoChallengeSupported","hasSavingState","listenTo","model","stopPoll","addView","add","createButton","click","e","preventDefault","render","checkbox","$el","find","length","hide","append","postRender","addClass","startPoll","startPolling","warningTimeout","setTimeout","warningText","showWarning","WARNING_TIMEOUT","stopPolling","clearWarning","msg","warning","$","hasClass","remove","clearTimeout","get","AUTHENTICATOR_KEY","OV","CUSTOM_APP","getSchemaByName","polling","AuthenticatorView","BaseAuthenticatorView"],"mappings":"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"}