{"version":3,"file":"PollView.js","sources":["../../../../../../src/v2/view-builder/views/PollView.js"],"sourcesContent":["import { loc, View } from '@okta/courage';\nimport hbs from '@okta/handlebars-inline-precompile';\nimport { BaseForm, BaseView } from '../internals';\nimport { MS_PER_SEC } from '../utils/Constants';\n\nconst PollMessageView = View.extend({\n  template: hbs`\n    <div class=\"ion-messages-container\">\n      <p>{{i18n code=\"poll.form.message\"\n        bundle=\"login\" arguments=\"countDownCounterValue\" $1=\"<span class='strong'>$1</span>\"}} </p>\n    </div>\n    <div class=\"hide okta-waiting-spinner\"></div>\n    `\n  ,\n  getTemplateData() {\n    const countDownCounterValue = this.options;\n    return {\n      countDownCounterValue,\n    };\n  },\n});\n\nconst Body = BaseForm.extend(Object.assign(\n  {\n    title() {\n      return  loc('poll.form.title', 'login');\n    },\n\n    noButtonBar: true,\n\n    initialize() {\n      BaseForm.prototype.initialize.apply(this, arguments);\n      const refreshInterval = this.options.appState.getCurrentViewState().refresh;\n      this.refreshTimeout = setTimeout(() => {\n        this.$el.find('.okta-waiting-spinner').show();\n        // start after a small delay so that the spinner does not get hidden too soon\n        setTimeout(() => this.saveForm(this.model), 200);\n      }, refreshInterval);\n    },\n\n    render() {\n      BaseForm.prototype.render.apply(this, arguments);\n      this.countDownCounterValue = Math.ceil(this.options.appState.getCurrentViewState().refresh / MS_PER_SEC);\n      this.add(new PollMessageView(this.countDownCounterValue));\n      this.startCountDown('.ion-messages-container span', MS_PER_SEC);\n    },\n\n    remove() {\n      BaseForm.prototype.remove.apply(this, arguments);\n      clearTimeout(this.refreshTimeout);\n    },\n\n    triggerAfterError() {\n      BaseForm.prototype.triggerAfterError.apply(this, arguments);\n      clearTimeout(this.refreshTimeout);\n      this.stopCountDown();\n      this.$el.find('.o-form-fieldset-container').empty();\n    },\n\n    startCountDown(selector , interval) {\n      if (this.countDown) {\n        clearInterval(this.countDown);\n      }\n      this.counterEl = this.$el.find(selector);\n      this.countDown = setInterval(() => {\n        if(this.counterEl.text() !== '0') {\n          this.counterEl.text(this.counterEl.text() - 1);\n        }\n      }, interval, this);\n    },\n\n    stopCountDown() {\n      if (this.countDown) {\n        clearInterval(this.countDown);\n      }\n    },\n  },\n));\n\nexport default BaseView.extend({\n  Body\n});\n"],"names":["PollMessageView","View","extend","template","_Handlebars2","main","container","depth0","helpers","partials","data","lookupProperty","parent","propertyName","Object","prototype","hasOwnProperty","call","undefined","escapeExpression","hooks","helperMissing","nullContext","getTemplateData","countDownCounterValue","options","Body","BaseForm","assign","title","loc","noButtonBar","initialize","apply","arguments","refreshInterval","appState","getCurrentViewState","refresh","refreshTimeout","setTimeout","$el","find","show","saveForm","model","render","Math","ceil","MS_PER_SEC","add","startCountDown","remove","clearTimeout","triggerAfterError","stopCountDown","empty","selector","interval","countDown","clearInterval","counterEl","setInterval","text","BaseView"],"mappings":"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"}