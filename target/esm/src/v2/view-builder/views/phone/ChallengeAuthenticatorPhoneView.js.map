{"version":3,"file":"ChallengeAuthenticatorPhoneView.js","sources":["../../../../../../../src/v2/view-builder/views/phone/ChallengeAuthenticatorPhoneView.js"],"sourcesContent":["import { loc, createCallout } from '@okta/courage';\nimport { BaseForm, BaseView } from '../../internals';\nimport BaseAuthenticatorView from '../../components/BaseAuthenticatorView';\nimport BaseResendView from '../shared/BaseResendView';\n\nconst ResendView = BaseResendView.extend(\n  {\n    // To be shown after a timeout\n    className: 'phone-authenticator-challenge__resend-warning hide',\n    events: {\n      'click a.resend-link': 'handleResendLink'\n    },\n    modelEvents: {\n      'error': 'handleError'\n    },\n    \n    // Override this to change the resend action location from response\n    resendActionKey: 'currentAuthenticatorEnrollment-resend',\n\n    initialize() {\n      const resendText = (this.model.get('mode') === 'sms')\n        ? loc('oie.phone.verify.sms.resendText', 'login')\n        : loc('oie.phone.verify.call.resendText', 'login');\n      const linkText = (this.model.get('mode') === 'sms')\n        ? loc('oie.phone.verify.sms.resendLinkText', 'login')\n        : loc('oie.phone.verify.call.resendLinkText', 'login');\n      this.add(createCallout({\n        content: `${resendText}&nbsp;<a class='resend-link'>${linkText}</a>`,\n        type: 'warning',\n      }));\n    },\n\n    hideResendViewAndShowAfterTimeout() {\n      // Hide warning, but start a timeout again..\n      if (!this.el.classList.contains('hide')) {\n        this.el.classList.add('hide');\n      }\n      this.showCalloutAfterTimeout();\n    },\n\n    handleResendLink(ev) {\n      ev?.preventDefault();\n      this.options.appState.trigger('invokeAction', this.resendActionKey);\n      this.hideResendViewAndShowAfterTimeout();\n    },\n\n    handleError() {\n      this.hideResendViewAndShowAfterTimeout();\n    },\n  },\n);\n\nconst Body = BaseForm.extend(Object.assign(\n  {\n    className: 'phone-authenticator-challenge',\n\n    title() {\n      return loc('oie.phone.verify.title', 'login');\n    },\n\n    save() {\n      return loc('mfa.challenge.verify', 'login');\n    },\n\n    initialize() {\n      BaseForm.prototype.initialize.apply(this, arguments);\n      const sendText = (this.model.get('mode') === 'sms')\n        ? loc('oie.phone.verify.sms.codeSentText', 'login')\n        : loc('mfa.calling', 'login');\n      const enterCodeText = loc('oie.phone.verify.enterCodeText', 'login');\n      const carrierChargesText = loc('oie.phone.carrier.charges', 'login');\n      const isPhoneNumberAvailable = this.model.get('phoneNumber') !== loc('oie.phone.alternate.title', 'login');\n      const strongClass = isPhoneNumberAvailable ? 'strong no-translate nowrap' : '';\n      \n      const nickname = isPhoneNumberAvailable ? this.model.get('nickname') : '';\n      const nicknameText = nickname ? ` (${nickname})` : '';\n      const extraNicknameCssClasses = nicknameText ? 'no-translate authenticator-verify-nickname' : '';\n\n      const nicknameTemplate = nicknameText \n        ? `<span class=\"${extraNicknameCssClasses || ''}\"}>${nicknameText}.</span>`\n        : '<span class=\"no-translate\">.</span>';\n      \n      // Courage doesn't support HTML, hence creating a subtitle here.\n      this.add('<div class=\"okta-form-subtitle\" data-se=\"o-form-explain\">' + \n        `${sendText} ` + \n        `<span class=\"${strongClass}\">${this.model.escape('phoneNumber')}</span>` + \n        `${nicknameTemplate}` + \n        `&nbsp;${enterCodeText}` + \n        `<p>${carrierChargesText}</p>` + \n        '</div>', {\n        prepend: true,\n        selector: '.o-form-fieldset-container',\n      });\n    },\n\n    postRender() {\n      BaseForm.prototype.postRender.apply(this, arguments);\n      this.add(ResendView, {\n        selector: '.o-form-info-container',\n        prepend: true,\n      });\n    },\n  },\n));\n\nexport default BaseAuthenticatorView.extend({\n  Body,\n\n  createModelClass() {\n    const relatesToObject = this.options.currentViewState.relatesTo;\n    const { methods, profile, nickname } = relatesToObject?.value || {};\n    const ModelClass = BaseView.prototype.createModelClass.apply(this, arguments);\n    const local = Object.assign({\n      mode: {\n        'value': methods[0].type,\n        'type': 'string',\n      },\n      phoneNumber: {\n        'value': profile?.phoneNumber ? profile.phoneNumber : loc('oie.phone.alternate.title', 'login'),\n        'type': 'string',\n      },\n      nickname: {\n        'value': nickname ? nickname : '',\n        'type': 'string',\n      }\n    }, ModelClass.prototype.local );\n    return ModelClass.extend({ local });\n  },\n});\n\nexport { ResendView };"],"names":["ResendView","BaseResendView","extend","className","events","modelEvents","resendActionKey","initialize","resendText","model","get","loc","linkText","add","createCallout","content","type","hideResendViewAndShowAfterTimeout","el","classList","contains","showCalloutAfterTimeout","handleResendLink","ev","preventDefault","options","appState","trigger","handleError","Body","BaseForm","Object","assign","title","save","prototype","apply","arguments","sendText","enterCodeText","carrierChargesText","isPhoneNumberAvailable","strongClass","nickname","nicknameText","extraNicknameCssClasses","nicknameTemplate","escape","prepend","selector","postRender","BaseAuthenticatorView","createModelClass","relatesToObject","currentViewState","relatesTo","methods","profile","value","ModelClass","BaseView","local","mode","phoneNumber"],"mappings":"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"}