{"version":3,"file":"ion-object-handler.js","sources":["../../../../../../src/v2/ion/ui-schema/ion-object-handler.js"],"sourcesContent":["/*!\n * Copyright (c) 2020, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _ } from '@okta/courage';\nimport { AUTHENTICATOR_KEY } from '../RemediationConstants';\n\n/**\n * Example of the option like\n * @param {AuthenticatorOption[]} options\n * @param {( AuthenticatorEnrollment[] || Authenticator[] )} authenticators\n */\nexport function createOVOptions(options = []) {\n  // Split OV into individual entries for verification (one for each method).\n  const ovItem = options.find((option) => option.relatesTo.key === AUTHENTICATOR_KEY.OV);\n  const methodTypeObj = ovItem?.value?.form?.value?.find(v => v.name === 'methodType');\n  const methodOptions = methodTypeObj?.options;\n  let signedNonceOption;\n  if (methodOptions) {\n    const ovOptions = [];\n    methodOptions.forEach((method) => {\n      // get value object from the ov item\n      const value = [...ovItem.value.form.value];\n      // get index of the methodType object within the value object\n      const methodTypeIndex = ovItem.value.form.value.findIndex((v) => v.name === 'methodType');\n      // create a new methodType object that removes the options array and\n      // has a value of the current method\n      const newMethodTypeObj = Object.assign(_.omit(methodTypeObj, 'options'), method);\n      // set the methodType field to be required and immutable in our UI,\n      // so it is always sent to the backend.\n      newMethodTypeObj.required = true;\n      newMethodTypeObj.mutable = false;\n      // replace old methodType object with the new one\n      value.splice(methodTypeIndex, 1, newMethodTypeObj);\n      // return a new ov item for a specific method\n      const newItem = Object.assign({}, ovItem, {\n        label: method.label,\n        value: {\n          form: {\n            value,\n          }\n        }\n      });\n      if (method.value === 'signed_nonce') {\n        signedNonceOption = newItem;\n      } else {\n        ovOptions.push(newItem);\n      }\n    });\n    const ovIndex = options.findIndex((option) => option.relatesTo.key === AUTHENTICATOR_KEY.OV);\n    options.splice(ovIndex, 1, ...ovOptions);\n\n    // ReArrange fastpass in options based on deviceKnown\n    if (signedNonceOption) {\n      ovItem.relatesTo.deviceKnown ? options.unshift(signedNonceOption) : options.push(signedNonceOption);\n    }\n  }\n}\n\nfunction createAuthenticatorOptions(options = []) {\n  createOVOptions(options);\n  return options.map(option => {\n    const value = option.value?.form?.value || [];\n\n    // Each authenticator option has list of ION field.\n    // Currently we only support merely selecting one of options\n    // rather than pop up another page to collect extra data\n    // (in order to fill value for `mutable: true; value: null` fields).\n    // The only reason of such design is to simplify widget implementation\n    // but could subject to change in later releases.\n    // Thus only surface up fields that are `required: true; mutable: false`\n    // which implies it already has `value`.\n    const valueObject = value\n      .filter(v => v.required === true && v.mutable === false)\n      .reduce((init, v) => {\n        return Object.assign(init, { [v.name]: v.value });\n      }, {});\n    return {\n      label: option.label,\n      value: valueObject,\n      relatesTo: option.relatesTo,\n      authenticatorKey: option.relatesTo?.key,\n    };\n  });\n}\n\nfunction getAuthenticatorsEnrollUiSchema({ options }) {\n  return {\n    type: 'authenticatorEnrollSelect',\n    options: createAuthenticatorOptions(options),\n  };\n}\n\nfunction getAuthenticatorsVerifyUiSchema({ options }) {\n  return {\n    type: 'authenticatorVerifySelect',\n    options: createAuthenticatorOptions(options),\n  };\n}\n\n/**\n  * Create ui schema for ION field that has type 'object'.\n  */\nexport default function createUiSchemaForObject(ionFormField, remediationForm, transformedResp,\n  createUISchema, settings) {\n  const uiSchema = {};\n\n  if (ionFormField.name === 'authenticator' &&\n    (remediationForm.name === 'select-authenticator-authenticate' ||\n    remediationForm.name === 'select-authenticator-unlock-account')) {\n    // 1. when `select-authenticator-authenticator`,\n    // create customize type so that display authenticator list as selectable list\n    Object.assign(uiSchema, getAuthenticatorsVerifyUiSchema(ionFormField));\n  } else if (ionFormField.name === 'authenticator' && remediationForm.name === 'select-authenticator-enroll') {\n    // 2. when `select-authenticator-enroll`,\n    // create customize type so that display authenticator list as selectable list\n    Object.assign(uiSchema, getAuthenticatorsEnrollUiSchema(ionFormField));\n  } else if (Array.isArray(ionFormField.options)) {\n    // 3. For other cases, create ui schema for each `option` in order to render\n    // different view for each option.\n    //\n    // e.g. { \"name\": \"credentials\", \"type\": \"object\", options: [ {value: {form: value:[]} ]\n    uiSchema.optionsUiSchemas = ionFormField.options.map(opt => {\n      return createUISchema(transformedResp, {\n        value: [\n          {\n            name: ionFormField.name,\n            value: opt.value,\n          }\n        ]\n      }, settings);\n    });\n    uiSchema.options = ionFormField.options.map((opt, index) => {\n      return { label: opt.label, value: index };\n    });\n    // assume (default to) use radio buttons to switch sub-schema.\n    uiSchema.type = 'radio';\n    uiSchema.value = '0';\n    uiSchema.name = `sub_schema_local_${ionFormField.name}`;\n  }\n\n  return uiSchema;\n}\n"],"names":["createOVOptions","options","_ovItem$value","_ovItem$value$form","_ovItem$value$form$va","ovItem","find","option","relatesTo","key","AUTHENTICATOR_KEY","OV","methodTypeObj","value","form","v","name","methodOptions","signedNonceOption","ovOptions","forEach","method","methodTypeIndex","findIndex","newMethodTypeObj","Object","assign","_","omit","required","mutable","splice","newItem","label","push","ovIndex","deviceKnown","unshift","createAuthenticatorOptions","map","_option$value","_option$value$form","_option$relatesTo","valueObject","filter","reduce","init","authenticatorKey","getAuthenticatorsEnrollUiSchema","type","getAuthenticatorsVerifyUiSchema","createUiSchemaForObject","ionFormField","remediationForm","transformedResp","createUISchema","settings","uiSchema","Array","isArray","optionsUiSchemas","opt","index"],"mappings":"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"}