{"version":3,"file":"ion-string-handler.js","sources":["../../../../../../src/v2/ion/ui-schema/ion-string-handler.js"],"sourcesContent":["/*!\n * Copyright (c) 2020, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n/* eslint max-depth: [2, 3] */\n/* eslint complexity: [2, 20] */\nimport { loc } from '@okta/courage';\nimport { HINTS, ATTR_FORMAT } from '../RemediationConstants';\nimport CountryUtil from 'util/CountryUtil';\nimport TimeZone from '../../view-builder/utils/TimeZone';\n\nconst ionOptionsToUiOptions = (options) => {\n  const result = {};\n  options.forEach(({ value, label }) => {\n    result[value] = label;\n  });\n  return result;\n};\n\nconst getPasswordUiSchema = (settings) => ({\n  type: 'password',\n  params: {\n    showPasswordToggle: settings.get('showPasswordToggle'),\n  },\n});\n\nconst getCaptchaUiSchema = () => {\n  return {\n    type: 'captcha',\n  };\n};\n\nconst timezoneUISchema = {\n  type: 'select',\n  wide: true\n};\n\nconst shouldRenderAsRadio = (name) => name.indexOf('methodType') >= 0 || name.indexOf('channel') >= 0;\n\nconst optionalType = ['text', 'radio', 'select'];\n\nconst populateUISchemaForDisplay = (uiSchema, ionField) => {\n  const display = ionField?.value?.value;\n  uiSchema.type = display.inputType;\n  if (display.inputType === 'radio') {\n    uiSchema.options = display.options;\n  } else if (display.inputType === 'select') {\n    uiSchema.wide = true;\n    if (display.format === ATTR_FORMAT.COUNTRY_CODE) {\n      uiSchema.options = Object.assign({'': ''}, CountryUtil.getCountryCode());\n    } else {\n      //it will create a placeholder for dropdowns, by default it will show 'Select an Option'\n      uiSchema.options = Object.assign({'': ''}, ionOptionsToUiOptions(display.options));\n    }\n  }\n};\n\nconst populateUISchemaForRadio = (uiSchema, ionFormField) => {\n  // e.g. { name: 'methodType', options: [ {label: 'sms'} ], type: 'string' | null }\n  uiSchema.type = 'radio';\n  // set the default value to the first value.\n  ionFormField.value = ionFormField.options[0].value;\n};\n\nconst createUiSchemaForString = (ionFormField, remediationForm, transformedResp, createUISchema, settings) => {\n  const uiSchema = {\n    type: 'text'\n  };\n\n  // e.g. { name: 'password', secret: true }\n  if (ionFormField.secret === true) {\n    Object.assign(uiSchema, getPasswordUiSchema(settings));\n  }\n\n  if (ionFormField.hint === HINTS.CAPTCHA) {\n    Object.assign(uiSchema, getCaptchaUiSchema());\n  }\n\n  if(ionFormField.name === 'userProfile.timezone'){\n    Object.assign(uiSchema, timezoneUISchema);\n    uiSchema.options = Object.assign({'': ''}, TimeZone);\n  }\n\n  if (Array.isArray(ionFormField.options) && ionFormField.options[0] && ionFormField.options[0].value) {\n    const ionField = ionFormField.options[0];\n    if (ionField.label === 'display') {\n      populateUISchemaForDisplay(uiSchema, ionField);\n    } else if (shouldRenderAsRadio(ionFormField.name)) {\n      populateUISchemaForRadio(uiSchema, ionFormField);\n    } else {\n      // default to select (dropdown). no particular reason (certainly can default to radio.)\n      // e.g. { name: 'questionKey', options: [], type: 'string' | null }\n      uiSchema.type = 'select';\n      uiSchema.wide = true;\n      uiSchema.options = ionOptionsToUiOptions(ionFormField.options);\n    }\n  }\n\n  // set a label as 'Optional' for supported optional element types\n  if(ionFormField.required === false && optionalType.includes(uiSchema.type)) {\n    uiSchema.sublabel = loc('oie.form.field.optional', 'login');\n  }\n\n  return uiSchema;\n};\n\nexport default createUiSchemaForString;\n"],"names":["ionOptionsToUiOptions","options","result","forEach","value","label","getPasswordUiSchema","settings","type","params","showPasswordToggle","get","getCaptchaUiSchema","timezoneUISchema","wide","shouldRenderAsRadio","name","indexOf","optionalType","populateUISchemaForDisplay","uiSchema","ionField","_ionField$value","display","inputType","format","ATTR_FORMAT","COUNTRY_CODE","Object","assign","CountryUtil","getCountryCode","populateUISchemaForRadio","ionFormField","createUiSchemaForString","remediationForm","transformedResp","createUISchema","secret","hint","HINTS","CAPTCHA","TimeZone","Array","isArray","required","includes","sublabel","loc"],"mappings":"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"}