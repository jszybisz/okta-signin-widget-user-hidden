{"version":3,"file":"EnrollCallAndSmsController.js","sources":["../../../../../src/v1/controllers/EnrollCallAndSmsController.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n/* eslint complexity: [2, 8] */\nimport { _, loc, internal, View } from '@okta/courage';\nimport hbs from '@okta/handlebars-inline-precompile';\nimport CountryUtil from 'util/CountryUtil';\nimport Enums from 'util/Enums';\nimport FormController from 'v1/util/FormController';\nimport FormType from 'v1/util/FormType';\nimport Util from 'util/Util';\nimport Footer from 'v1/views/enroll-factors/Footer';\nimport PhoneTextBox from 'v1/views/enroll-factors/PhoneTextBox';\nimport TextBox from 'v1/views/shared/TextBox';\nlet { Keys } = internal.util;\nconst EnrollCallAndSmsControllerwarningTemplate = View.extend({\n  className: 'okta-form-infobox-warning infobox infobox-warning login-timeout-warning',\n  attributes: {\n    'aria-live': 'polite',\n  },\n  template: hbs`\n      <span class=\"icon warning-16\"></span>\n      <p>{{{warning}}}</p>\n    `,\n});\nconst factorIdIsDefined = {\n  factorId: function(val) {\n    return !_.isUndefined(val);\n  },\n};\n\nfunction isCallFactor(factorType) {\n  return factorType === 'call';\n}\n\nfunction getClassName(factorType) {\n  return isCallFactor(factorType) ? 'enroll-call' : 'enroll-sms';\n}\n\nfunction sendCode(e) {\n  if (Keys.isEnter(e)) {\n    e.stopPropagation();\n    e.preventDefault();\n    if (e.type === 'keyup' && e.data && e.data.model) {\n      e.data.model.sendCode();\n    }\n  }\n}\n\nexport default FormController.extend({\n  className: function() {\n    return getClassName(this.options.factorType);\n  },\n  Model: function() {\n    return {\n      props: {\n        phoneNumber: ['string', true],\n        phoneExtension: ['string', false],\n        lastEnrolledPhoneNumber: 'string',\n        passCode: ['string', true],\n        factorId: 'string',\n      },\n      local: {\n        countryCode: ['string', false, this.options.appState.get('userCountryCode')],\n        hasExistingPhones: 'boolean',\n        trapEnrollment: 'boolean',\n        ableToResend: 'boolean',\n        factorType: 'string',\n        skipPhoneValidation: 'boolean',\n      },\n      derived: {\n        countryCallingCode: {\n          deps: ['countryCode'],\n          fn: function(countryCode) {\n            return '+' + CountryUtil.getCallingCodeForCountry(countryCode);\n          },\n        },\n        fullPhoneNumber: {\n          deps: ['countryCallingCode', 'phoneNumber'],\n          fn: function(countryCallingCode, phoneNumber) {\n            return phoneNumber ? countryCallingCode + phoneNumber : '';\n          },\n        },\n        enrolled: {\n          deps: ['lastEnrolledPhoneNumber', 'fullPhoneNumber'],\n          fn: function(lastEnrolled, current) {\n            return lastEnrolled === current;\n          },\n        },\n      },\n      limitResending: function() {\n        this.set({ ableToResend: false });\n        _.delay(_.bind(this.set, this), Enums.API_RATE_LIMIT, { ableToResend: true });\n      },\n      sendCode: function() {\n        const self = this;\n        const phoneNumber = this.get('fullPhoneNumber');\n        const phoneExtension = this.get('phoneExtension');\n  \n        self.trigger('errors:clear');\n  \n        if (!phoneNumber.length) {\n          self.trigger('invalid', self, { phoneNumber: 'model.validation.field.blank' });\n          return;\n        }\n  \n        return this.doTransaction(function(transaction) {\n          const isMfaEnroll = transaction.status === 'MFA_ENROLL' || transaction.status === 'FACTOR_ENROLL';\n          const profileData = {\n            phoneNumber: phoneNumber,\n            updatePhone: isMfaEnroll ? self.get('hasExistingPhones') : true,\n          };\n  \n          if (isCallFactor(self.get('factorType'))) {\n            profileData['phoneExtension'] = phoneExtension;\n          }\n  \n          if (self.get('skipPhoneValidation')) {\n            profileData['validatePhone'] = false;\n          }\n  \n          const doEnroll = function(trans) {\n            const factor = _.findWhere(trans.factors, {\n              factorType: self.get('factorType'),\n              provider: 'OKTA',\n            });\n  \n            return factor\n              .enroll({\n                profile: profileData,\n              })\n              .catch(function(error) {\n                if (error.errorCode === 'E0000098') {\n                  // E0000098: \"This phone number is invalid.\"\n                  self.set('skipPhoneValidation', true);\n                  error.xhr.responseJSON.errorSummary = loc('enroll.sms.try_again', 'login');\n                }\n                throw error;\n              });\n          };\n  \n          if (isMfaEnroll) {\n            return doEnroll(transaction);\n          } else {\n            // We must transition to MfaEnroll before updating the phone number\n            self.set('trapEnrollment', true);\n            return transaction.prev().then(doEnroll).then(function(trans) {\n              self.set('trapEnrollment', false);\n              return trans;\n            });\n          }\n          // Rethrow errors so we can change state\n          // AFTER setting the new transaction\n        }, true)\n          .then(function() {\n            self.set('lastEnrolledPhoneNumber', phoneNumber);\n            self.limitResending();\n          })\n          .catch(function() {\n            self.set('trapEnrollment', false);\n          });\n      },\n      resendCode: function() {\n        this.trigger('errors:clear');\n        this.limitResending();\n        return this.doTransaction(function(transaction) {\n          return transaction.resend(this.get('factorType'));\n        });\n      },\n      save: function() {\n        return this.doTransaction(function(transaction) {\n          return transaction.activate({\n            passCode: this.get('passCode'),\n          });\n        });\n      },\n    };\n  },\n  Form: function() {\n    const factorType = this.options.factorType;\n    const isCall = isCallFactor(factorType);\n    const formTitle = loc(isCall ? 'enroll.call.setup' : 'enroll.sms.setup', 'login');\n    const formSubmit = loc(isCall ? 'mfa.call' : 'mfa.sendCode', 'login');\n    const formRetry = loc(isCall ? 'mfa.redial' : 'mfa.resendCode', 'login');\n    const formSubmitted = loc(isCall ? 'mfa.calling' : 'mfa.sent', 'login');\n    const numberFieldClassName = isCall ? 'enroll-call-phone' : 'enroll-sms-phone';\n    const buttonClassName = isCall ? 'call-request-button' : 'sms-request-button';\n    const formChildren = [\n      FormType.Input({\n        name: 'countryCode',\n        type: 'select',\n        wide: true,\n        options: CountryUtil.getCountries(),\n      }),\n      FormType.Input({\n        label: loc('mfa.phoneNumber.placeholder', 'login'),\n        'label-top': true,\n        className: numberFieldClassName,\n        name: 'phoneNumber',\n        input: PhoneTextBox,\n        type: 'text',\n        render: function() {\n          this.$('input[name=\"phoneNumber\"]')\n            .off('keydown keyup', sendCode)\n            .keydown(sendCode)\n            .keyup({ model: this.model }, sendCode);\n        },\n      }),\n    ];\n\n    if (isCall) {\n      formChildren.push(\n        FormType.Input({\n          label: loc('mfa.phoneNumber.ext.placeholder', 'login'),\n          'label-top': true,\n          className: 'enroll-call-extension',\n          name: 'phoneExtension',\n          input: TextBox,\n          type: 'text',\n        })\n      );\n    }\n    formChildren.push(\n      FormType.Button({\n        title: formSubmit,\n        attributes: { 'data-se': buttonClassName },\n        className: 'button button-primary js-enroll-phone margin-top-30 ' + buttonClassName,\n        click: function() {\n          this.model.sendCode();\n        },\n      }),\n      FormType.Button({\n        title: formRetry,\n        attributes: { 'data-se': buttonClassName },\n        className: 'button js-enroll-phone margin-top-30 ' + buttonClassName,\n        click: function() {\n          this.model.resendCode();\n        },\n        initialize: function() {\n          this.$el.css({ display: 'none' });\n          this.listenTo(this.model, 'change:ableToResend', function(model, ableToResend) {\n            if (ableToResend) {\n              this.options.title = formRetry;\n              this.enable();\n            } else {\n              this.options.title = formSubmitted;\n              this.disable();\n            }\n            this.render();\n          });\n        },\n      }),\n      FormType.Divider({\n        showWhen: factorIdIsDefined,\n      }),\n      FormType.Input({\n        label: loc('mfa.challenge.enterCode.placeholder', 'login'),\n        'label-top': true,\n        explain: Util.createInputExplain(\n          'mfa.challenge.enterCode.tooltip',\n          'mfa.challenge.enterCode.placeholder',\n          'login'\n        ),\n        'explain-top': true,\n        name: 'passCode',\n        input: TextBox,\n        type: 'tel',\n        showWhen: factorIdIsDefined,\n      }),\n      FormType.Toolbar({\n        noCancelButton: true,\n        save: loc('mfa.challenge.verify', 'login'),\n        showWhen: factorIdIsDefined,\n      })\n    );\n\n    return {\n      title: formTitle,\n      noButtonBar: true,\n      autoSave: true,\n      className: getClassName(factorType),\n\n      showWarning: function(msg) {\n        this.clearWarnings();\n        this.add(EnrollCallAndSmsControllerwarningTemplate, '.o-form-error-container', { options: { warning: msg } });\n      },\n\n      clearWarnings: function() {\n        this.$('.okta-form-infobox-warning').remove();\n      },\n\n      initialize: function() {\n        const callTimeWarning = hbs`{{i18n\n          code=\"factor.call.time.warning\"\n          bundle=\"login\"\n          $1=\"<b>$1</b>\"\n        }}`;\n        const smsTimeWarning = hbs`{{i18n\n          code=\"factor.sms.time.warning\"\n          bundle=\"login\"\n          $1=\"<b>$1</b>\"\n        }}`;\n        this.listenTo(this.model, 'change:ableToResend', function(model, ableToResend) {\n          if (ableToResend) {\n            this.showWarning(isCall ? callTimeWarning : smsTimeWarning);\n          } else {\n            this.clearWarnings();\n          }\n        });\n        this.listenTo(this.model, 'error errors:clear', function() {\n          this.clearWarnings();\n          this.clearErrors();\n        });\n        this.listenTo(this.model, 'change:enrolled', function() {\n          this.$('.js-enroll-phone').toggle();\n        });\n      },\n      formChildren: formChildren,\n    };\n  },\n\n  Footer: Footer,\n\n  trapAuthResponse: function() {\n    if (this.options.appState.get('isMfaEnrollActivate')) {\n      this.model.set('factorId', this.options.appState.get('activatedFactorId'));\n      return true;\n    }\n    if (this.options.appState.get('isMfaEnroll') && this.model.get('trapEnrollment')) {\n      return true;\n    }\n  },\n\n  initialize: function() {\n    if (isCallFactor(this.options.factorType)) {\n      this.model.set('hasExistingPhones', this.options.appState.get('hasExistingPhonesForCall'));\n    } else {\n      this.model.set('hasExistingPhones', this.options.appState.get('hasExistingPhones'));\n    }\n    this.model.set('factorType', this.options.factorType);\n  },\n});\n"],"names":["Keys","internal","util","EnrollCallAndSmsControllerwarningTemplate","View","extend","className","attributes","template","_Handlebars2","main","container","depth0","helpers","partials","data","stack1","helper","lookupProperty","parent","propertyName","Object","prototype","hasOwnProperty","call","undefined","hooks","helperMissing","nullContext","factorIdIsDefined","factorId","val","_","isUndefined","isCallFactor","factorType","getClassName","sendCode","e","isEnter","stopPropagation","preventDefault","type","model","FormController","options","Model","props","phoneNumber","phoneExtension","lastEnrolledPhoneNumber","passCode","local","countryCode","appState","get","hasExistingPhones","trapEnrollment","ableToResend","skipPhoneValidation","derived","countryCallingCode","deps","fn","CountryUtil","getCallingCodeForCountry","fullPhoneNumber","enrolled","lastEnrolled","current","limitResending","set","delay","bind","Enums","API_RATE_LIMIT","self","trigger","length","doTransaction","transaction","isMfaEnroll","status","profileData","updatePhone","doEnroll","trans","factor","findWhere","factors","provider","enroll","profile","catch","error","errorCode","xhr","responseJSON","errorSummary","loc","prev","then","resendCode","resend","save","activate","Form","isCall","formTitle","formSubmit","formRetry","formSubmitted","numberFieldClassName","buttonClassName","formChildren","FormType","Input","name","wide","getCountries","label","input","PhoneTextBox","render","$","off","keydown","keyup","push","TextBox","Button","title","click","initialize","$el","css","display","listenTo","enable","disable","Divider","showWhen","explain","Util","createInputExplain","Toolbar","noCancelButton","noButtonBar","autoSave","showWarning","msg","clearWarnings","add","warning","remove","callTimeWarning","escapeExpression","smsTimeWarning","clearErrors","toggle","Footer","trapAuthResponse"],"mappings":"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"}