{"version":3,"file":"DeviceActivateController.js","sources":["../../../../../src/v1/controllers/DeviceActivateController.js"],"sourcesContent":["/*!\n * Copyright (c) 2017, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n/* eslint max-len: [2, 160] */\nimport hbs from '@okta/handlebars-inline-precompile';\nimport {loc, View} from '@okta/courage';\nimport FormController from 'v1/util/FormController';\nimport FormType from 'v1/util/FormType';\nimport TextBox from 'v1/views/shared/TextBox';\n\nconst InvalidUserCodeErrorView = View.extend({\n  template: hbs`\n      <div class=\"okta-form-infobox-error infobox infobox-error\" role=\"alert\">\n          <span class=\"icon error-16\"></span>\n           <p>{{i18n code=\"api.authn.error.PASSCODE_INVALID\" bundle=\"login\"}}</p>\n      </div>\n    `\n});\n\nexport default FormController.extend({\n  className: 'device-code-activate',\n  Model: function() {\n    return {\n      props: {\n        userCode: ['string', true, this.options?.appState?.get('userCode')],\n        stateToken: 'string',\n      },\n      save: function() {\n        const self = this;\n        return this.doTransaction(function(transaction) {\n          return transaction.deviceActivate({\n            userCode: self.get('userCode')\n          });\n        });\n      }\n    };\n  },\n  Form: {\n    noCancelButton: true,\n    autoSave: true,\n    save: function() {\n      return loc('oform.next', 'login');\n    },\n    title: function() {\n      return loc('device.code.activate.title', 'login');\n    },\n    subtitle() {\n      return loc('device.code.activate.subtitle', 'login');\n    },\n    formChildren: function() {\n      if (this.options.appState.get('deviceActivationStatus') === 'INVALID_USER_CODE') {\n        this.add(InvalidUserCodeErrorView, '.o-form-error-container');\n      }\n\n      return [\n        FormType.Input({\n          label: loc('device.code.activate.label', 'login'),\n          'label-top': true,\n          name: 'userCode',\n          input: TextBox,\n          inputId: 'user-code',\n          type: 'text',\n          inlineValidation: false,\n        })\n      ];\n    },\n    events: {\n      'keyup input[name=\"userCode\"]': function(e) {\n        e.preventDefault();\n        this.addHyphen(e);\n      }\n    },\n    addHyphen(evt) {\n      const currentVal = evt.target.value;\n      // add hyphen after 4th character\n      if (currentVal && currentVal.length === 4 && !['Backspace', 'Delete', '-'].includes(evt.key)) {\n        evt.target.value = currentVal.concat('-');\n      }\n    }\n  },\n});\n"],"names":["InvalidUserCodeErrorView","View","extend","template","_Handlebars2","main","container","depth0","helpers","partials","data","lookupProperty","parent","propertyName","Object","prototype","hasOwnProperty","call","undefined","escapeExpression","hooks","helperMissing","nullContext","FormController","className","Model","_this$options","_this$options$appStat","props","userCode","options","appState","get","stateToken","save","self","doTransaction","transaction","deviceActivate","Form","noCancelButton","autoSave","loc","title","subtitle","formChildren","add","FormType","Input","label","name","input","TextBox","inputId","type","inlineValidation","events","e","preventDefault","addHyphen","evt","currentVal","target","value","length","includes","key","concat"],"mappings":"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"}