{"version":3,"file":"SendEmailAndVerifyCodeForm.js","sources":["../../../../../../src/v1/views/mfa-verify/SendEmailAndVerifyCodeForm.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2019, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { _, Form, loc, View } from '@okta/courage';\nimport hbs from '@okta/handlebars-inline-precompile';\nimport ResendEmailView from 'v1/views/ResendEmailView';\nimport TextBox from 'v1/views/shared/TextBox';\n\nconst createEmailMaskElement = function() {\n  const email = this.model.get('email');\n  const emailTpl = hbs('<span class=\"mask-email\">{{email}}</span>');\n  return { factorEmail: emailTpl({ email }) };\n};\n\nconst SendEmailAndVerifyCodeFormVerifyEmailCodeForm = Form.extend({\n  layout: 'o-form-theme',\n  className: 'mfa-verify-email',\n  title: _.partial(loc, 'email.mfa.title', 'login'),\n  noButtonBar: false,\n  autoSave: true,\n  noCancelButton: true,\n  attributes: {\n    'data-se': 'factor-email',\n  },\n  save: function() {\n    return this.options.appState.get('isMfaChallenge')\n      ? loc('mfa.challenge.verify', 'login')\n      : loc('email.button.send', 'login');\n  },\n\n  events: Object.assign({}, Form.prototype.events, {\n    submit: function(e) {\n      e.preventDefault();\n      this.handleSubmit();\n    },\n  }),\n\n  handleSubmit() {\n    this.clearErrors();\n    if (this.options.appState.get('isMfaChallenge')) {\n      if (this.isValid()) {\n        this.model.save();\n      }\n    } else {\n      // Send email and switch to verification view\n      this.model.set('answer', '');\n      this.model.save().then(this.renderChallengView.bind(this));\n    }\n  },\n\n  initialize: function() {\n    Form.prototype.initialize.apply(this, arguments);\n\n    // render 'Send Email' page at first place\n    this.add(\n      View.extend({\n        attributes: {\n          'data-se': 'mfa-send-email-content',\n        },\n        className: 'mfa-send-email-content',\n        template: hbs('{{{i18n code=\"email.mfa.description\" bundle=\"login\" arguments=\"factorEmail\"}}}'),\n        getTemplateData: createEmailMaskElement,\n      })\n    );\n  },\n\n  renderChallengView: function() {\n    this.removeChildren();\n    this.add(\n      View.extend({\n        className: 'mfa-email-sent-content',\n        attributes: {\n          'data-se': 'mfa-email-sent-content',\n        },\n        // Why use `{{{` for the description?\n        // - factorEmail is actually an HTML fragment which\n        //   is created via another handlebar template and used for bold the email address.\n        template: hbs('{{{i18n code=\"email.mfa.email.sent.description\" bundle=\"login\" arguments=\"factorEmail\"}}}'),\n        getTemplateData: createEmailMaskElement,\n      })\n    );\n\n    this.add(ResendEmailView);\n\n    this.addInput({\n      label: loc('email.code.label', 'login'),\n      'label-top': true,\n      name: 'answer',\n      input: TextBox,\n      wide: true,\n      type: 'tel',\n    });\n    if (this.options.appState.get('allowRememberDevice')) {\n      this.addInput({\n        label: false,\n        'label-top': true,\n        placeholder: this.options.appState.get('rememberDeviceLabel'),\n        className: 'margin-btm-0',\n        name: 'rememberDevice',\n        type: 'checkbox',\n      });\n    }\n    this.render();\n  },\n});\n\nexport default SendEmailAndVerifyCodeFormVerifyEmailCodeForm;\n"],"names":["createEmailMaskElement","email","model","get","emailTpl","_Handlebars2","template","main","container","depth0","helpers","partials","data","helper","lookupProperty","parent","propertyName","Object","prototype","hasOwnProperty","call","undefined","escapeExpression","hooks","helperMissing","nullContext","factorEmail","SendEmailAndVerifyCodeFormVerifyEmailCodeForm","Form","extend","layout","className","title","_","partial","loc","noButtonBar","autoSave","noCancelButton","attributes","save","options","appState","events","assign","submit","e","preventDefault","handleSubmit","clearErrors","isValid","set","then","renderChallengView","bind","initialize","apply","arguments","add","View","stack1","getTemplateData","removeChildren","ResendEmailView","addInput","label","name","input","TextBox","wide","type","placeholder","render"],"mappings":";;;;;;;;;;;;;AAiBA,MAAMA,sBAAsB,GAAG,YAAW;EACxC,MAAMC,KAAK,GAAG,IAAI,CAACC,KAAK,CAACC,GAAG,CAAC,OAAO,CAAC,CAAA;AACrC,EAAA,MAAMC,QAAQ,GAAAC,YAAA,CAAAC,QAAA,CAAA;AAAA,IAAA,UAAA,EAAA,CAAA,CAAA,EAAA,UAAA,CAAA;IAAA,MAAAC,EAAAA,UAAAC,SAAA,EAAAC,MAAA,EAAAC,OAAA,EAAAC,QAAA,EAAAC,IAAA,EAAA;AAAA,MAAA,IAAAC,MAAA;AAAAC,QAAAA,cAAA,GAAAN,SAAA,CAAAM,cAAA,IAAAC,UAAAA,MAAA,EAAAC,YAAA,EAAA;UAAA,IAAAC,MAAA,CAAAC,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAL,MAAA,EAAAC,YAAA,CAAA,EAAA;YAAA,OAAAD,MAAA,CAAAC,YAAA,CAAA,CAAA;AAAA,WAAA;AAAA,UAAA,OAAAK,SAAA,CAAA;AAAA,SAAA,CAAA;AAAA,MAAA,OAAA,6BAAA,GAAAb,SAAA,CAAAc,gBAAA,EAAAT,MAAA,GAAA,CAAAA,MAAA,GAAAC,cAAA,CAAAJ,OAAA,eAAAD,MAAA,IAAA,IAAA,GAAAK,cAAA,CAAAL,MAAA,aAAAA,MAAA,CAAA,KAAA,IAAA,GAAAI,MAAA,GAAAL,SAAA,CAAAe,KAAA,CAAAC,aAAA,EAAA,OAAAX,MAAA,KAAAA,UAAAA,GAAAA,MAAA,CAAAO,IAAA,CAAAX,MAAA,IAAA,IAAA,GAAAA,MAAA,GAAAD,SAAA,CAAAiB,WAAA,IAAA,EAAA,EAAA;AAAA,QAAA,MAAA,EAAA,OAAA;AAAA,QAAA,MAAA,EAAA,EAAA;AAAA,QAAA,MAAA,EAAAb,IAAA;AAAA,QAAA,KAAA,EAAA;AAAA,UAAA,OAAA,EAAA;AAAA,YAAA,MAAA,EAAA,CAAA;AAAA,YAAA,QAAA,EAAA,EAAA;AAAA,WAAA;AAAA,UAAA,KAAA,EAAA;AAAA,YAAA,MAAA,EAAA,CAAA;AAAA,YAAA,QAAA,EAAA,EAAA;AAAA,WAAA;AAAA,SAAA;AAAA,OAAA,CAAA,GAAAC,MAAA,EAAA,GAAA,SAAA,CAAA;AAAA,KAAA;AAAA,IAAA,SAAA,EAAA,IAAA;GAAmD,CAAA,CAAA;EACjE,OAAO;IAAEa,WAAW,EAAEtB,QAAQ,CAAC;AAAEH,MAAAA,KAAK,EAALA,KAAAA;KAAO,CAAA;GAAG,CAAA;AAC7C,CAAC,CAAA;AAED,MAAM0B,6CAA6C,GAAGC,IAAI,CAACC,MAAM,CAAC;AAChEC,EAAAA,MAAM,EAAE,cAAc;AACtBC,EAAAA,SAAS,EAAE,kBAAkB;EAC7BC,KAAK,EAAEC,cAAC,CAACC,OAAO,CAACC,GAAG,EAAE,iBAAiB,EAAE,OAAO,CAAC;AACjDC,EAAAA,WAAW,EAAE,KAAK;AAClBC,EAAAA,QAAQ,EAAE,IAAI;AACdC,EAAAA,cAAc,EAAE,IAAI;AACpBC,EAAAA,UAAU,EAAE;AACV,IAAA,SAAS,EAAE,cAAA;GACZ;EACDC,IAAI,EAAE,YAAW;IACf,OAAO,IAAI,CAACC,OAAO,CAACC,QAAQ,CAACvC,GAAG,CAAC,gBAAgB,CAAC,GAC9CgC,GAAG,CAAC,sBAAsB,EAAE,OAAO,CAAC,GACpCA,GAAG,CAAC,mBAAmB,EAAE,OAAO,CAAC,CAAA;GACtC;AAEDQ,EAAAA,MAAM,EAAE1B,MAAM,CAAC2B,MAAM,CAAC,EAAE,EAAEhB,IAAI,CAACV,SAAS,CAACyB,MAAM,EAAE;AAC/CE,IAAAA,MAAM,EAAE,UAASC,CAAC,EAAE;MAClBA,CAAC,CAACC,cAAc,EAAE,CAAA;MAClB,IAAI,CAACC,YAAY,EAAE,CAAA;AACrB,KAAA;AACF,GAAC,CAAC;EAEFA,YAAY,EAAA,YAAG;IACb,IAAI,CAACC,WAAW,EAAE,CAAA;IAClB,IAAI,IAAI,CAACR,OAAO,CAACC,QAAQ,CAACvC,GAAG,CAAC,gBAAgB,CAAC,EAAE;AAC/C,MAAA,IAAI,IAAI,CAAC+C,OAAO,EAAE,EAAE;AAClB,QAAA,IAAI,CAAChD,KAAK,CAACsC,IAAI,EAAE,CAAA;AACnB,OAAA;AACF,KAAC,MAAM;AACL;MACA,IAAI,CAACtC,KAAK,CAACiD,GAAG,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAA;AAC5B,MAAA,IAAI,CAACjD,KAAK,CAACsC,IAAI,EAAE,CAACY,IAAI,CAAC,IAAI,CAACC,kBAAkB,CAACC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAA;AAC5D,KAAA;GACD;EAEDC,UAAU,EAAE,YAAW;IACrB3B,IAAI,CAACV,SAAS,CAACqC,UAAU,CAACC,KAAK,CAAC,IAAI,EAAEC,SAAS,CAAC,CAAA;;AAEhD;AACA,IAAA,IAAI,CAACC,GAAG,CACNC,IAAI,CAAC9B,MAAM,CAAC;AACVU,MAAAA,UAAU,EAAE;AACV,QAAA,SAAS,EAAE,wBAAA;OACZ;AACDR,MAAAA,SAAS,EAAE,wBAAwB;MACnCzB,QAAQ,EAAAD,YAAA,CAAAC,QAAA,CAAA;AAAA,QAAA,UAAA,EAAA,CAAA,CAAA,EAAA,UAAA,CAAA;QAAA,MAAAC,EAAAA,UAAAC,SAAA,EAAAC,MAAA,EAAAC,OAAA,EAAAC,QAAA,EAAAC,IAAA,EAAA;AAAA,UAAA,IAAAgD,MAAA;AAAA9C,YAAAA,cAAA,GAAAN,SAAA,CAAAM,cAAA,IAAAC,UAAAA,MAAA,EAAAC,YAAA,EAAA;cAAA,IAAAC,MAAA,CAAAC,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAL,MAAA,EAAAC,YAAA,CAAA,EAAA;gBAAA,OAAAD,MAAA,CAAAC,YAAA,CAAA,CAAA;AAAA,eAAA;AAAA,cAAA,OAAAK,SAAA,CAAA;AAAA,aAAA,CAAA;UAAA,OAAAuC,CAAAA,MAAA,GAAA9C,CAAAA,cAAA,CAAAJ,OAAA,EAAAD,MAAAA,CAAAA,IAAAA,MAAA,IAAAK,cAAA,CAAAL,MAAA,EAAAD,MAAAA,CAAAA,IAAAA,SAAA,CAAAe,KAAA,CAAAC,aAAA,EAAAJ,IAAA,CAAAX,MAAA,IAAA,IAAA,GAAAA,MAAA,GAAAD,SAAA,CAAAiB,WAAA,IAAA,EAAA,EAAA;AAAA,YAAA,MAAA,EAAA,MAAA;AAAA,YAAA,MAAA,EAAA;AAAA,cAAA,WAAA,EAAA,aAAA;AAAA,cAAA,QAAA,EAAA,OAAA;AAAA,cAAA,MAAA,EAAA,uBAAA;AAAA,aAAA;AAAA,YAAA,MAAA,EAAAb,IAAA;AAAA,YAAA,KAAA,EAAA;AAAA,cAAA,OAAA,EAAA;AAAA,gBAAA,MAAA,EAAA,CAAA;AAAA,gBAAA,QAAA,EAAA,CAAA;AAAA,eAAA;AAAA,cAAA,KAAA,EAAA;AAAA,gBAAA,MAAA,EAAA,CAAA;AAAA,gBAAA,QAAA,EAAA,EAAA;AAAA,eAAA;AAAA,aAAA;AAAA,WAAA,CAAA,KAAA,IAAA,GAAAgD,MAAA,GAAA,EAAA,CAAA;AAAA,SAAA;AAAA,QAAA,SAAA,EAAA,IAAA;OAAuF,CAAA;AAC/FC,MAAAA,eAAe,EAAE7D,sBAAAA;AACnB,KAAC,CACH,CAAC,CAAA;GACF;EAEDqD,kBAAkB,EAAE,YAAW;IAC7B,IAAI,CAACS,cAAc,EAAE,CAAA;AACrB,IAAA,IAAI,CAACJ,GAAG,CACNC,IAAI,CAAC9B,MAAM,CAAC;AACVE,MAAAA,SAAS,EAAE,wBAAwB;AACnCQ,MAAAA,UAAU,EAAE;AACV,QAAA,SAAS,EAAE,wBAAA;OACZ;AACD;AACA;AACA;MACAjC,QAAQ,EAAAD,YAAA,CAAAC,QAAA,CAAA;AAAA,QAAA,UAAA,EAAA,CAAA,CAAA,EAAA,UAAA,CAAA;QAAA,MAAAC,EAAAA,UAAAC,SAAA,EAAAC,MAAA,EAAAC,OAAA,EAAAC,QAAA,EAAAC,IAAA,EAAA;AAAA,UAAA,IAAAgD,MAAA;AAAA9C,YAAAA,cAAA,GAAAN,SAAA,CAAAM,cAAA,IAAAC,UAAAA,MAAA,EAAAC,YAAA,EAAA;cAAA,IAAAC,MAAA,CAAAC,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAL,MAAA,EAAAC,YAAA,CAAA,EAAA;gBAAA,OAAAD,MAAA,CAAAC,YAAA,CAAA,CAAA;AAAA,eAAA;AAAA,cAAA,OAAAK,SAAA,CAAA;AAAA,aAAA,CAAA;UAAA,OAAAuC,CAAAA,MAAA,GAAA9C,CAAAA,cAAA,CAAAJ,OAAA,EAAAD,MAAAA,CAAAA,IAAAA,MAAA,IAAAK,cAAA,CAAAL,MAAA,EAAAD,MAAAA,CAAAA,IAAAA,SAAA,CAAAe,KAAA,CAAAC,aAAA,EAAAJ,IAAA,CAAAX,MAAA,IAAA,IAAA,GAAAA,MAAA,GAAAD,SAAA,CAAAiB,WAAA,IAAA,EAAA,EAAA;AAAA,YAAA,MAAA,EAAA,MAAA;AAAA,YAAA,MAAA,EAAA;AAAA,cAAA,WAAA,EAAA,aAAA;AAAA,cAAA,QAAA,EAAA,OAAA;AAAA,cAAA,MAAA,EAAA,kCAAA;AAAA,aAAA;AAAA,YAAA,MAAA,EAAAb,IAAA;AAAA,YAAA,KAAA,EAAA;AAAA,cAAA,OAAA,EAAA;AAAA,gBAAA,MAAA,EAAA,CAAA;AAAA,gBAAA,QAAA,EAAA,CAAA;AAAA,eAAA;AAAA,cAAA,KAAA,EAAA;AAAA,gBAAA,MAAA,EAAA,CAAA;AAAA,gBAAA,QAAA,EAAA,EAAA;AAAA,eAAA;AAAA,aAAA;AAAA,WAAA,CAAA,KAAA,IAAA,GAAAgD,MAAA,GAAA,EAAA,CAAA;AAAA,SAAA;AAAA,QAAA,SAAA,EAAA,IAAA;OAAkG,CAAA;AAC1GC,MAAAA,eAAe,EAAE7D,sBAAAA;AACnB,KAAC,CACH,CAAC,CAAA;AAED,IAAA,IAAI,CAAC0D,GAAG,CAACK,eAAe,CAAC,CAAA;IAEzB,IAAI,CAACC,QAAQ,CAAC;AACZC,MAAAA,KAAK,EAAE9B,GAAG,CAAC,kBAAkB,EAAE,OAAO,CAAC;AACvC,MAAA,WAAW,EAAE,IAAI;AACjB+B,MAAAA,IAAI,EAAE,QAAQ;AACdC,MAAAA,KAAK,EAAEC,OAAO;AACdC,MAAAA,IAAI,EAAE,IAAI;AACVC,MAAAA,IAAI,EAAE,KAAA;AACR,KAAC,CAAC,CAAA;IACF,IAAI,IAAI,CAAC7B,OAAO,CAACC,QAAQ,CAACvC,GAAG,CAAC,qBAAqB,CAAC,EAAE;MACpD,IAAI,CAAC6D,QAAQ,CAAC;AACZC,QAAAA,KAAK,EAAE,KAAK;AACZ,QAAA,WAAW,EAAE,IAAI;QACjBM,WAAW,EAAE,IAAI,CAAC9B,OAAO,CAACC,QAAQ,CAACvC,GAAG,CAAC,qBAAqB,CAAC;AAC7D4B,QAAAA,SAAS,EAAE,cAAc;AACzBmC,QAAAA,IAAI,EAAE,gBAAgB;AACtBI,QAAAA,IAAI,EAAE,UAAA;AACR,OAAC,CAAC,CAAA;AACJ,KAAA;IACA,IAAI,CAACE,MAAM,EAAE,CAAA;AACf,GAAA;AACF,CAAC;;;;"}